{% extends "enduser/base.html" %}

{% block title %}Pixify-Home{% endblock %}


{% block content %}
{%load static %}
{% load humanize %}

<script>
    $(document).ready(function() {
        $('#postForm').on('submit', function(e) {
            e.preventDefault(); 
            const FirstPostId = $('#postid').val();
           
            let formData = new FormData(this); 

            $.ajax({
                url: "{% url 'userpost_create' %}",
                type: "POST",

                data: formData,
                processData: false,
                contentType: false,
                postid:FirstPostId,

                success: function(response) {
                    if (response.success) {

                    $('#addPhotosVideosModal').modal('hide');
                    $('#postForm')[0].reset();

                    } else {
                        alert("Error: " + response.message);
                    }
                },
                error: function(xhr, status, error) {
                    alert("AJAX error: " + error);
                }
            });
        });
    });
</script>
{% comment %} <head>

</head> {% endcomment %}

<div class="px-3 py-3 mt-3" id="homepage">
    <!-- story short view -->
   <div class="stories-container ">
       <div class="content">
           <div class="previous-btn active1">
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                   <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                 </svg>
           </div>
           <div class="stories">

                    <div class="mx-1 bg- rounded story" onclick="uploadStory()" type="button" style="width: 6rem; height: 180px;background-color: #bf16e0e3 " >
                       <img src="static\images\p1.jpg" alt="story post" class="card-img-top" style="min-height: 105px; object-fit: cover;">
                        <div class="d-flex align-items-center justify-content-center position-relative" style="min-height: 65px; background: relative;">
                            <p class="mb-0 text-center fs-7 fw-bold" style="color: white; position: relative;">Create story</p>
                            <div class="position-absolute top-0 start-50 translate-middle plus-btn">
                              <i class="fas fa-plus-circle fs-3 text-primary bg-white p-1 rounded-circle" >
                               </i>
                            </div>
                        </div>
                    </div>

                   {% if story_dict.storys %}
                    {% for story in story_dict.storys %}
                    <div class="story">
                    <!-- {% for media in story.media_url %} -->
                    <img src="{% static story.media_url.0 %}" alt="">
                    <!-- {%endfor%} -->
                     <div>
                        <div class="dp">
                            <img src="" alt="">
                         </div>
                         <span class="author">hello</span>

                     </div>


                </div>
             {% endfor %}
            {% endif %}
           </div>

           <div class="next-btn actived">
               <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                   <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
               </svg>
           </div>
       </div>
   </div>
   <!-- stories-full-view -->

   <div class="container-fluid stories-full-view" id="story-view">
    <div class="close-btn position-absolute" id="close-story">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
    </div>

    <div class="content mx-auto d-flex align-items-center justify-content-between">
        <!-- Previous Button -->
        <div class="previous-btn text-white" id="prev-story">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
            </svg>
        </div>

        <!-- Story Content -->
        <div class="story position-relative">
            <img src="" alt="Story Image" class="img-fluid rounded" id="story-img">
            <div class="author position-absolute text-white fw-bold">Sribash Sarkar</div>
            <div id="dp" class="position-absolute">
                <img src="" alt="Profile Picture" class="rounded-circle border border-primary">
            </div>
            <div class="time-line position-absolute bg-primary"></div>
        </div>

        <!-- Next Button -->
        <div class="next-btn text-white" id="next-story">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
            </svg>
        </div>
    </div>
</div>

<!--Post Section-->

 <div class="pt-1 pb-3 px-2 mb-2 fw-semibold mt-4" id="uploadPostSection" >

    <div class="container mt-4">
      <div class="d-flex align-items-center">
        <img src="{% static 'images/green.png'%}" alt="Profile" class="rounded-circle me-3" style="width: 40px; height: 40px; object-fit: cover;">
        <div class="pb-1" data-bs-toggle="modal" data-bs-target="#addPhotosVideosModal" id="addPhotosVideosModalInputdiv">
            <input class="form-control" placeholder="" id="addPhotosVideosModalInput"></input>
      </div>

    </div>
    <div class="d-flex justify-content-between text-center py-2 mt-3">
      <div class="d-flex align-items-center justify-content-center mb-3 mb-sm-0" style="cursor: pointer;">
          <i class="bi bi-camera-video-fill text-danger me-2 fs-5"></i>
          <span>Live video</span>
      </div>
      <div class="d-flex align-items-center justify-content-center mb-3 mb-sm-0" data-bs-toggle="modal" data-bs-target="#addPhotosVideosModal" style="cursor: pointer;">
          <i class="bi bi-image-fill text-success me-2 fs-5"></i>
          <span>Photo/video</span>
      </div>
       <div class="d-flex align-items-center justify-content-center" id="FeelingActivity" style="cursor: pointer;">
          <i class="bi bi-emoji-smile-fill text-warning me-2 fs-5"></i>
          <span>Feeling/activity</span>
      </div>
  </div>
  </div>
  </div>



<!--Post Modal-->
<div class="modal fade" id="addPhotosVideosModal" tabindex="-1" aria-labelledby="addPhotosVideosModalLabel"
  aria-hidden="true" >
  <div class="modal-dialog">
      <div class="modal-content">

        <form  id="postForm" enctype="multipart/form-data">
            {% csrf_token %}
          <div class="modal-header">
            <h5 class="modal-title mx-auto" id="addPhotosVideosModalLabel">Create Post</h5>
            <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close" style="margin-left: 0px;"></button>
          </div>

          <div class="modal-body">

              <div class="d-flex align-items-center mb-3" style="margin-top:10px;">
                  <img src="{% static 'images/avatar.jpg' %}" alt="User Avatar"
                      class="user-avatar me-2">
                  <span class="fw-bold "style="color:white">Priya Mitra</span>
              </div>
              <div class="mb-3  ">
                  <textarea class="form-control  " name="postTitle" placeholder="What do you want to talk about?" rows="2"
                      style="resize: none;background-color: #27236e"></textarea>
              </div>

              <div class="mb-3" >
                    <label for="fileInput" class="file-upload-label" style="width: 100%; outline:none; border:none">
                      <input type="file" name="postFiles" class="form-control d-none" id="fileInput" multiple>
                      <div
                          id="dropZone">
                          <p style="color:black;" class="select">Drag and drop photos or videos, or click to browse</p>
                          <i class="bi bi-image" style="color:black; font-size:22px;" class="inner"></i>
                      </div>
                  </label>

                <div class="con">
                </div>
            </div> 


            <div class="pt-1 pb-3 px-2 mb-2 fw-semibold text-dark rounded" >
                <div class=" d-flex justify-content-between rounded p-2" style="border:1px solid black;align-items:center;background-color:white;" >

                    <span class="">Add to your post</span>

                    <div class="gap-3 d-flex md-icon ">
                    <i class="bi bi-images text-success" ></i>
                    <i class="bi bi-tag text-primary"></i>
                    <i class="bi bi-emoji-smile text-warning"></i>
                    <i class="bi bi-geo-alt-fill text-danger"></i>
                    <i class="bi bi-filetype-gif text-info"></i>
                </div>
                </div>

            </div>
          </div>
          <div class="justify-content-center mx-auto mb-3">
              <button type="submit" id="postForm'" id="load-more" class="btn text-dark  mx-auto b_btn px-3 d-flex" style="background-color:white;">Post</button>
          </div>
        </form>
      </div>
  </div>
</div>
</div>

<div class="py-3 mt-2 mb-5" id="homePagePostsection">

    {% if post_dict.posts %}

        {% for post in post_dict.posts %}


     <div class="container post-center pb-3 mb-3">

        <div class="post-box">

            <input type="hidden" class="firstPostId" name="firstPostId" value="{{post.id}}">
            <input type="hidden" class="firstUserId" name="firstUserId" value="{{post.posted_by_id}}">


        <div class="post-top" style="height: 45px;">
            <a href="">
                <img src="{% static 'images/IMG_20240915_213320.jpg' %}" alt="avatar" class="rounded-circle me-1 " style="width: 35px; object-fit: cover; height: 35px; " >
            </a>

            <div class="d-flex "style="flex-direction: column;" >
             <h6 class="u-name"> {{ post.posted_by.first_name }} {{ post.posted_by.last_name }}
                 <span style="font-size:14px;color:#e9e6e6c7;">Upload his profile picture</span>  </h6>

             <span style="font-size:11px;margin-left: 15px;position: relative;bottom: 14px;" class="py-1">{{ post.created_at|timesince }} ago <i class="bi bi-globe-americas p-1" style="font-size:10px"></i></span>

            </div>
        </div>

        <div class="post-des-img">
            <p class="px-3 pt-2" style="font-size:15px; margin: 0; margin-bottom: 5px;padding-bottom:13px;">{{ post.title }}</p>

            {% if post.media_url|length == 1 %}
            <div style="height:450px;">
                <img src="{% static post.media_url.0 %}" class="img-fluid" alt="Responsive image"style="height:100%;width:100%;object-fit:cover;">
            </div>
            {% elif post.media_url|length > 1 %}
                <div id="carouselExampleIndicators{{ post.id }}" class="carousel slide">
                    <div class="carousel-indicators">
                        {% for media in post.media_url %}
                            <button type="button" data-bs-target="#carouselExampleIndicators{{ post.id }}" data-bs-slide-to="{{ forloop.counter0 }}" class="{% if forloop.first %}active{% endif %}" aria-current="{% if forloop.first %}true{% endif %}" aria-label="Slide {{ forloop.counter }}"></button>
                        {% endfor %}
                    </div>

                    <div class="carousel-inner">
                        {% for media in post.media_url %}
                            <div class="carousel-item {% if forloop.first %}active{% endif %}" style="height:450px">
                                <img src="{% static media %}" class="d-block" height="350" width="100%" alt="Slide {{ forloop.counter }}">
                            </div>
                        {% endfor %}
                    </div>

                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators{{ post.id }}" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators{{ post.id }}" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            {% endif %}
        </div>

        <div>
            <div class="d-flex align-items-center px-2 ">
                <i class="bi bi-hand-thumbs-up pe-1" style="font-size:12px"></i> <i class="bi bi-heart" style="font-size:12px"></i>
                <span style="font-size:14px;color:#e9e6e6c7;" class="px-2"> Rima Das, Sribash Sarkar and <span>9</span> others</span>
                <span style="font-size:14px;color:#e9e6e6c7;" class="ms-auto pe-2">{{ post_dict.count_commnet }} comments</span>
            </div>
        </div>

        <div class="post-react-det">
            <div class="post-react">
                
               <div  class="hover-container">

              
                <div class="reaction-container">
                    
                    <i class="fa-regular fa-heart" >

                    </i>
                </div>
                <div class="emoji-reactions">
                    <span onclick="reactToPost( 1)">😮</span>
                    <span onclick="reactToPost( 1)">👍</span>
                    <span onclick="reactToPost( 1)">❤️</span>
                    <span onclick="reactToPost( 1)">😂</span>
                </div>
                <p id="feedback"></p>
             </div>
                <span data-toggle="modal" class="load-comments"><i class="fa-regular fa-comment"></i></span>
                <i class="fa-solid fa-share-nodes" data-bs-toggle="modal" data-bs-target="#shareModal"></i>
            </div>
        </div>
        </div>
    </div>

    {% endfor %}
    {% endif %}
<script>

        function reactToPost(postId, reactionId, reactionValue) {
            const csrfToken = '{{ csrf_token }}'; // Ensure this is passed in a Django template
           
            const data = {
                postId: postId,
                reactionId: reactionId,
                reactionValue: reactionValue,
            };
            console.log(data)
            // Send an AJAX POST request
            fetch('/post_reaction/create/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken, // Add CSRF token for security
                },
                body: JSON.stringify(data),
            })
            console.log("body  ",body)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        document.getElementById('feedback').innerText = data.message;
                    } else {
                        document.getElementById('feedback').innerText = 'Error: ' + data.message;
                    }
                })
                .catch(error => {
                    document.getElementById('feedback').innerText = 'An error occurred: ' + error.message;
                });
        }
        document.querySelectorAll('.emoji-reactions span').forEach((span, index) => {
            span.addEventListener('click', function () {
                const postId = document.querySelector('.firstPostId').value; // Get the postId
                const reactionId = index + 1; // Assuming each reaction is uniquely identified by its index
                const reactionValue = this.textContent; // The emoji itself as a value
                reactToPost(postId, reactionId, reactionValue); // Call the function
            });
        });
    </script>
    
            

<div class="container post-center mb-3">
    <div class="post-box">

    <div class="post-top" style="height: 45px;">
        <a href="">
            <img src="{% static 'images/IMG_20240915_213320.jpg' %}" alt="avatar" class="rounded-circle me-1 " style="width: 35px; object-fit: cover; height: 35px; " >
        </a>
        <div class="d-flex "style="flex-direction: column;" >
         <h6 class="u-name"> Sribash Sarkar <span style="font-size:14px;color:#e9e6e6c7;">Upload his profile picture</span></h6>
         <span style="font-size:12px;margin-left: 13px;position: relative;bottom: 10px;" class="">1h.<i class="bi bi-globe-americas p-1" style="font-size:10px"></i></span>
        </div>
    </div>

    <div class="post-des-img">
        <p class="px-3 pt-2" style="font-size:15px; margin: 0; margin-bottom: 5px;padding-bottom:13px;" >Wow, this is good</p>
        <img src="{% static 'images/pict.png' %}" class="img-fluid" alt="Responsive image">
    </div>

    <div>
        <div class="d-flex align-items-center px-2 ">
            <i class="bi bi-hand-thumbs-up pe-1"style="font-size:12px"></i> <i class="bi bi-heart  "style="font-size:12px"></i>
            <span style="font-size:14px;color:#e9e6e6c7;" class="px-2"> Rima Das, Sribash Sarkar and others</span>
            <span style="font-size:14px;color:#e9e6e6c7;" class="ms-auto pe-2">5 comments</span>
        </div>
        </div>
    <div class="post-react-det">
        <div class="post-react">
            <i class="fa-regular fa-heart"></i>
            <a href="/comments"><i class="fa-regular fa-comment"></i></a>
            <i class="fa-solid fa-bookmark me-2"></i>
            <i class="fa-solid fa-share-nodes"  data-bs-toggle="modal" data-bs-target="#shareModal"></i>
            <i class="fa-solid fa-pen post-pe-icon"  data-bs-toggle="modal" data-bs-target="#editpostModal"></i>
            <i class="fa-solid fa-trash post-pe-icon"></i>
        </div>
       </div>
    </div>

</div>


<!--Edit Modal -->
<div class="modal fade" id="editpostModal" tabindex="-1" aria-labelledby="editpostModalLabel" aria-hidden="true" >
    <div class="modal-dialog">
        <div class="modal-content   " style="background-color:#2f066de3;" >
            <div class="modal-header" >
                <h5 class="modal-title mx-auto" id="editpostModalLabel">Edit Post</h5>
                <button type="button" class="btn-close ml-5" data-bs-dismiss="modal" aria-label="Close" style="margin-left:0px;"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex align-items-center mb-3" style="margin-top:10px;">
                    <img src="{% static 'images/avatar.jpg' %}" alt="User Avatar"
                        class="user-avatar me-2">
                    <span class="fw-bold text-light">Priya Mitra is with Rima Das, Sribash Sarkar, Badhan <br>and 16 others <button class="text-white px-2 rounded " style="outline:none;border:none;background: transparent;"><i class="bi bi-people-fill px-1"></i>Friends(+)<i class="bi bi-caret-down-fill"></i></button> </span>
                </div>
                <div class="mb-3  ">
                    <textarea class="form-control text-dark " placeholder="caption..." rows="2"
                         style="outline:none;border:none;resize: none; background-color: #27236e"></textarea>
                </div>

                <div class="mb-3 ">

                      <div  class=" editpic  rounded" style="width: 100%; outline:none;border:none">
                         <img src="{% static 'images/p5.jpg' %}" alt="" class=" rounded">
                         <span style="font-size:40px;">&times</span>

                      </div>

                  <div class="con">
                  </div>
              </div>
              <div class="pt-1 pb-1 px-2 mb-1  fw-semibold text-dark rounded align-items-center" >
                <div class=" d-flex justify-content-between rounded p-2" style="border:1px solid black;align-items:center;box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;background-color:white;" >

                    <span class="">Add to your post</span>

                    <div class="gap-3 d-flex md-icon ">
                    <i class="bi bi-images text-success" ></i>
                    <i class="bi bi-tag text-primary"></i>
                    <i class="bi bi-emoji-smile text-warning"></i>
                    <i class="bi bi-geo-alt-fill text-danger"></i>
                    <i class="bi bi-filetype-gif text-info"></i>
                </div>
                  </div>

              </div>
            </div>
            <div class="justify-content-center mx-auto mb-3">
                <button type="button" class="btn text-dark mx-auto b_btn px-5" style="background-color:white" >Post</button>
            </div>
        </div>
    </div>
    </div>








    <!--Share Modal-->
    <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog">
            <div class="modal-content bg-purple text-light">
                <div class="modal-header">
                  <h5 class="modal-title mx-auto" id="shareModalLabel">Share Post</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="margin-left: 0px;"></button>
                </div>


                <div class="share-container">
                    <h5><img src="https://cdn-icons-png.flaticon.com/128/6997/6997662.png" alt="Profile Picture"
                            class="profile-pic">Rima Das </h5>
                    <input type="text" class="form-control mb-3" id="shareModalInput" placeholder="Type a name">

                    <div class="profile-item">
                        <img src="https://cdn-icons-png.flaticon.com/128/4140/4140047.png" alt="Profile Picture"
                            class="profile-pic">
                        <div>
                            <strong>Priya Mitra</strong><br>
                            <small>About user self</small>
                        </div>
                        <div class="custom-checkbox">
                            <input type="checkbox" id="user1" onclick="toggleShareButton()">
                        </div>
                    </div>
                    <div class="profile-item">
                        <img src="https://cdn-icons-png.flaticon.com/128/3135/3135715.png" alt="Profile Picture"
                            class="profile-pic">
                        <div>
                            <strong>Subhasis Barman</strong><br>
                            <small>About user self</small>
                        </div>
                        <div class="custom-checkbox">
                            <input type="checkbox" id="user2" onclick="toggleShareButton()">
                        </div>
                    </div>
                    <div class="profile-item">
                        <img src="https://cdn-icons-png.flaticon.com/128/3135/3135715.png" alt="Profile Picture"
                            class="profile-pic">
                        <div>
                            <strong>Sribash Sarkar</strong><br>
                            <small>About user self</small>
                        </div>
                        <div class="custom-checkbox">
                            <input type="checkbox" id="user3" onclick="toggleShareButton()">
                        </div>
                    </div>

                    <div class="profile-item mb-4">
                        <img src="https://cdn-icons-png.flaticon.com/128/3135/3135715.png" alt="Profile Picture"
                            class="profile-pic">
                        <div>
                            <strong>Badhan Sarkar</strong><br>
                            <small>About user self</small>
                        </div>
                        <div class="custom-checkbox">
                            <input type="checkbox" id="user4" onclick="toggleShareButton()">
                        </div>
                    </div>


                    <div class="share-button-container" id="shareButtonContainer">
                            <button class="btn btn-primary">
                                <i class="bi bi-send-fill"></i>
                            </button>
                    </div>
                    <div class="d-flex justify-content-center align-item-center">
                            <div class="icon-item px-2">
                                <i class="bi bi-chat-dots-fill text-light" ></i>
                            </div>

                            <div class="icon-item px-2">
                                <i class="bi bi-whatsapp text-light"></i>
                            </div>

                            <div class="icon-item px-2">
                                <i class="bi bi-person-lines-fill text-light"></i>
                            </div>

                            <div class="icon-item px-2">
                                <i class="bi bi-link-45deg text-light"></i>
                            </div>

                            <div class="icon-item px-2">
                                <i class="bi bi-people-fill text-light"></i>
                            </div>

                            <div class="icon-item px-2">
                                <i class="bi bi-file-earmark-text-fill text-light"></i>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-purple text-light">
                <div class="modal-header border-0">
                    <h5 class="modal-title" id="shareModalLabel" style="padding: 20px;">Share</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex  black-box">
                    <a href="#" class="icon whatsapp"><i class="fab fa-whatsapp"></i></a>
                    <a href="#" class="icon facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="icon twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="icon linkedin"><i class="fab fa-linkedin-in"></i></a>
                    <a href="#" class="icon instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="icon link"><i class="fas fa-link"></i></a>
                </div>
            </div>
        </div>
    </div>








{% comment %} comment modal by priya {% endcomment %}
<div  class="modal fade custom-modal" id="commentModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">

    <div class="modal-dialog modal-dialog-centered "role="document" >

        <div class="modal-content d-flex comment-mod" >

           <span class="modal-header p-0">
             <button type="button" class="btn-close " data-bs-dismiss="modal" aria-label="Close" style="color:white;right:5px;top:5px;position:relative;"></button>
            </span>


     <div style="display: flex; " class="comment-div">
        <div class="col-md-6 ">


            <div class="post-top d-flex  px-1 pb-2" style="height: 45px;" id="proffile" >


           </div>


            <div class="post-center pb-3 " style="margin-left: 0px;" id="photo_com">
                <p class="px-3 pt-2" style="font-size:15px; margin: 0; margin-bottom: 5px;" >wow cool</p>


                    <div class="post-box pb-2" >


                </div>
            </div>
        </div>


  <div class="" style="display:flex;flex-direction: column; justify-content:space-arround; ">

    <div class="comment-section " >

        <div style="height:50px;"> </div>
        <div class="comment-box p-1 com "id="comments-container"  style="height:500px; overflow-y: scroll;margin-left:20px;">

            <div class="pt-2 pe-2" style="height: auto;" class="comment" id="commentList"  id="autorefresh" id="commentsDiv">




            </div>

    </div>






    <input type="hidden"  id="postidd" style="color:black;">
    <input type="hidden"  id="useridd" style="color:black;">

   <form  id="commentForm" method="post" class="mt-3">
    {% csrf_token %}

    <div id="CommentsectionTextarea" class="container-fluid py-2 com_sent" style="position: absolute; bottom: 0; ">
        <div class="input-group ms-2">
            <!-- Left icons -->
            <div class="input-group-prepend d-flex gap-2 align-items-center pe-2">
                <i class="bi bi-emoji-smile text-light fs-6"></i>
            </div>

            <!-- Comment input -->
            <input
                class="form-control"
                id="commentText"
                name="comment_text"
                placeholder="Write a comment..."
                style="border-radius: 15px; background-color: #27236e; color: white;"
            >

            <!-- Right button -->
            <div class="input-group-append d-flex gap-3 align-items-center ps-2">
                <button id="createcomment" type="submit" class="btn btn-transparent text-info p-0">
                    <img src="{% static 'images/send-message.png' %}" alt="" style="height: 23px;">
                </button>
            </div>
        </div>
    </div>


  </form>
</div>
</div>

</div>

 </div>
</div>
  </div>

 </div>


<style>
    @media (min-width: 950px) {
        #CommentsectionTextarea {
            width: 480px;
            margin: 0 auto; /* Center the container */
        }
    }
    @media (min-width: 768px) and (max-width: 952px) {
        ##CommentsectionTextarea{
            width: 300px;
        }
    }

</style>

 <script src="{% static 'js/sribash.js' %}"></script>
<script>
  function uploadStory(){
    console.log("Clicked");
    window.location.href="/uploadStory"
  }

</script>




 <script>
    $(document).ready(function () {
        $('.load-comments').click(function () {
            const FirstPostId = $(this).closest('.post-box').find('.firstPostId').val();
            const FirstUserId = $(this).closest('.post-box').find('.firstUserId').val();
            console.log("closest  .... ",$(this).closest('.post-box'))
            console.log("get comment",FirstPostId)
            console.log("get user id",FirstUserId)




            $.ajax({
                url: 'comments/getComment/',
                type: 'GET',
                dataType: 'json',
                data: {
                    post_id: FirstPostId,
                    user_id: FirstUserId,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                  },
                success: function (data) {
                    console.log(data)


                     const postid= FirstPostId
                     const userid=FirstUserId
                     document.getElementById("postidd").value = postid;
                     document.getElementById("useridd").value = userid;
                    const commentList = $('#commentList');
                    const photo_com = $('#photo_com');
                    const com_profile=$('#proffile')

                    commentList.empty(); // Clear previous comments


data.user_details.forEach(com_del => {
const com_prof=`


<a href="" class="mx-1">
                    <img src="{% static 'images/IMG_20240915_213320.jpg' %}" alt="avatar" class="rounded-circle me-2 " style="width: 35px; object-fit: cover; height: 35px; " >
                </a>

                <div class="d-flex "style="flex-direction: column;" >
                 <h6 class="u-name mx-1"style="font-size:14px">${com_del.first_name} ${com_del.last_name} </h6>
                 <span style="font-size:11px;margin-left:5px;position: relative;bottom: 10px;" class="py-1">${new Date(com_del.created_at).toLocaleString([],  { weekday: 'long' })} ${new Date(com_del.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}<i class="bi bi-globe-americas p-1" style="font-size:10px"></i></span>

                 </div>    `;
com_profile.html(com_prof);
    });


  //  com_name.html(comname);
//});


 const postItem = `

                    <div class="post-des-img">

                     <p class="px-3 pt-2" style="font-size:15px; margin: 0; margin-bottom: 5px;" >gsgs</p>


                    <div class="post-box pb-2 px-2" >
                    ${data.posts[0].media_url.map(post => `
                                <div style="height:500px;">


                     <img src="static${post}" class="img-fluid" alt="Responsive image"style="height:100%;width:100%;object-fit:cover;">
                            </div>                                                              `).join('')}

                   </div>
                    </div>
                    <div class="">
                        <div>
                            <div class="d-flex align-items-center px-2 ">
                                <i class="bi bi-hand-thumbs-up pe-1"style="font-size:12px"></i> <i class="bi bi-heart  "style="font-size:12px"></i>
                                <span style="font-size:12px;color:#e9e6e6c7;" class="px-2"> Rima Das, Sribash Sarkar and <span>9</span> others</span>
                                <span style="font-size:12px;color:#e9e6e6c7;" class="ms-auto pe-2">5 comments</span>
                            </div>
                        </div>
                    </div>`
                    photo_com.html(postItem);



                    if (data.comments.length > 0) {
                        data.comments.forEach(comment => {

                            const commentItem = `


                           <div class="d-flex py-1">

                    <img src="{% static 'images/green.png'%}" alt="User" class="rounded-circle"
                        style="width:35px; height:35px;">
                    <div class="" class="d-flex" style="flex-direction: column;">
                          <div class="comment-text mb-0 ps-2 py-1 rounded px-3"
                             style="background-color:#311e4ee3;width: 300px;" id="com_by">

                            <span class="d-block fw-bold">${data.user_details[0].first_name} ${data.user_details[0].last_name}</span>
                              <li class="list-group-item">
                                <span style="font-size:13px">${comment.comment}</span>


                                </li>
                        </div>


                        <div class="d-flex p-1" style="gap:20px; margin-left: 17px;">
                            <span style="font-size:11px;cursor:pointer;">${new Date(comment.created_at).toLocaleString([],  { weekday: 'long' })} ${new Date(comment.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
                            <span style="font-size:11px;cursor:pointer;">Like</span>
                            <span style="font-size:11px;  cursor: pointer;" class="com-reply">Reply</span>
                        </div>

                        <span class="view-comment" style="cursor: pointer; font-size:14px;margin-left:12px;">View reply</span>



                 



                    </div>
                </div>



                                `;


                            commentList.append(commentItem);
                        });
                    } else {
                        commentList.append('<li class="list-group-item">No comments available.</li>');
                    }

                    $('#commentModal').modal('show');
                 },
                error: function (xhr, status, error) {
                    console.error('Error loading comments:', error);
                }
          });
        });
    });
 


{% comment %} input box comment {% endcomment %}

  $(document).ready(function () {
    $('#commentForm').on('submit', function (e) {
      e.preventDefault(); // Prevent default form submission

      const commentText = $('#commentText').val();
      const FirstPostId = $('#postidd').val();
      const FirstUsertId = $('#useridd').val();

      $.ajax({
        type: 'POST',
        url: '{% url "comment" %}',

        data: {
          post_id: FirstPostId,
          /*user_id:FirstUsertId,*/
          comment_text: commentText,
          csrfmiddlewaretoken: '{{ csrf_token }}',
        },
        headers: { "X-CSRFToken": "{{ csrf_token }}" },
        success: function (data) {
            console.log("response",data)

            // Refresh the comments section


          $('#commentText').val(''); // Clear textarea
          const commentList = $('#commentList');
          const photo_com = $('#photo_com');

          commentList.empty(); // Clear previous comments

          if (data.comments.length > 0) {


              data.comments.forEach(comment => {

                  const commentItem = `
              <div class="d-flex py-1">

                    <img src="{% static 'images/green.png'%}" alt="User" class="rounded-circle"
                        style="width:35px; height:35px;">
                    <div class="" class="d-flex" style="flex-direction: column;">
                          <div class="comment-text mb-0 ps-2 py-1 rounded px-3"
                             style="background-color:#311e4ee3;width: 300px;">

                            <span class="d-block fw-bold">${data.user_details[0].first_name} ${data.user_details[0].last_name}</span>
                              <li class="list-group-item">
                                <span style="font-size:13px">${comment.comment}</span>


                                </li>
                        </div>


                        <div class="d-flex p-1" style="gap:20px; margin-left: 17px;">
                            <span style="font-size:11px;cursor:pointer;">${new Date(comment.created_at).toLocaleString([],  { weekday: 'long' })} ${new Date(comment.created_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
                            <span style="font-size:11px;cursor:pointer;">Like</span>
                            <span style="font-size:11px;  cursor: pointer;" class="com-reply">Reply</span>
                        </div>

                        <span class="view-comment" style="cursor: pointer; font-size:14px;margin-left:12px;">View reply</span>



                



          </div>
      </div>



                      `;


                  commentList.append(commentItem);
              });
          } else {
              commentList.append('<li class="list-group-item">No comments available.</li>');
          }


        },
        error: function (xhr) {

        },
      });
    });
  });
</script>
<style>


        .custom-modal .modal-dialog {
          max-width: 1000px;

         

        }

        .modal-image {
            object-fit: cover;
            width: 100%;

        }

</style> 
{% comment %} <script>
    const postId = "{{ post_id }}"; // Replace with your actual post ID
    console.log(postId)
    const socket = new WebSocket(`ws://${window.location.host}/ws/comments/${postId}/`);

    socket.onmessage = function(event) {
        const data = JSON.parse(event.data);
        const commentList = document.getElementById('comment-list');
        const newComment = document.createElement('li');
        newComment.textContent = `${data.user}: ${data.comment}`;
        commentList.appendChild(newComment);
    };

    document.getElementById('comment-form').onsubmit = function(event) {
        event.preventDefault();
        const commentInput = document.getElementById('comment-input');
        const comment = commentInput.value;
        socket.send(JSON.stringify({ 'comment': comment }));
        commentInput.value = '';
    };
</script> {% endcomment %}

 {% endblock %}


